------------------------------------------------------------------------------
-- TASK				: 	MOSL DELIVERY CREATION 
--
-- AUTHOR         		: 	Kevin Burton
--
-- FILENAME       		: 	01_DDL_CREATE_DEL.sql
--
-- CREATED        		: 	18/04/2016
--	
-- DESCRIPTION 		   	: 	Creates all database tables for initial MOSL upload
--
-- NOTES  			:	
--
-- ASSOCIATED FILES		:	
-- ASSOCIATED SCRIPTS 	 	:	02_DDL_CREATE_DEL_VIEW.sql
--                                      03_DDL_CREATE_DEL_TRIGGERS.sql
--
--
---------------------------- Modification History ----------------------------------------------------------
--
-- Version     		Date        	 	Author         	Description
-- --------------------------------------------------------------------------------------------------------
-- V0.01	       	18/04/2016   	 	K.Burton	Initial version
-- V0.02    		19/04/2016              K.Burton        Added DEL_CALCULATED_DISCHARGE (Defect 12)
--                                                              Updated DEL_SERVICE_COMPONENT to alter constraints and add
--                                                              missing columns   
--                                                              Updates to DEL_METER
-- V0.03                20/04/2016              K.Burton        Altered check constraints on DEL_SERVICE_COMPONENT
--                                                              Removed trigger code to 03_DDL_CREATE_DEL_TRIGGERS.sql
--                                                              Removed postcode constraints
-- V0.04                21/04/2016              K.Burton        Added USPIPESIZE and UWPIPESIZE columns
------------------------------------------------------------------------------------------------------------


CREATE TABLE DEL_SUPPLY_POINT
(
SPID_PK VARCHAR(13) ,
WHOLESALERID VARCHAR2(12) CONSTRAINT CH01_WHOLESALERID NOT NULL,
RETAILERID VARCHAR2(12)  CONSTRAINT CH01_RETAILERID NOT NULL,
SERVICECATEGORY VARCHAR(1) CONSTRAINT CH01_SERVICECATEGORY NOT NULL,
SUPPLYPOINTEFFECTIVEFROMDATE DATE ,
PAIRINGREFREASONCODE VARCHAR(12) ,
OTHERWHOLESALERID VARCHAR(12) ,
MULTIPLEWHOLESALERFLAG NUMBER(1) CONSTRAINT CH01_MULTIPLEWHOLESALERFLAG NOT NULL,
DISCONRECONDEREGSTATUS VARCHAR(5) ,
VOABAREFERENCE VARCHAR(32) ,
VOABAREFRSNCODE VARCHAR(2) ,
UPRN NUMBER(13) ,
UPRNREASONCODE VARCHAR(2),
CUSTOMERCLASSIFICATION VARCHAR(5) CONSTRAINT CH01_CUSTOMERCLASSIFICATION NOT NULL,
PUBHEALTHRELSITEARR NUMBER(1) CONSTRAINT CH01_PUBHEALTHRELSITEARR NOT NULL,
NONPUBHEALTHRELSITE  NUMBER(1) CONSTRAINT CH01_NONPUBHEALTHRELSITE  NOT NULL,
NONPUBHEALTHRELSITEDSC VARCHAR(255) ,
STDINDUSTRYCLASSCODE VARCHAR(12) ,
STDINDUSTRYCLASSCODETYPE VARCHAR(4) ,
RATEABLEVALUE NUMBER(10,2) ,
OCCUPENCYSTATUS VARCHAR(12) CONSTRAINT CH01_OCCUPENCYSTATUS NOT NULL,
BUILDINGWATERSTATUS NUMBER(1) CONSTRAINT CH01_BUILDINGWATERSTATUS NOT NULL,
LANDLORDSPID VARCHAR(32) ,
SECTION154 NUMBER(4),
CUSTOMERNAME VARCHAR(255) CONSTRAINT CH01_CUSTOMERNAME NOT NULL,
CUSTOMERBANNERNAME VARCHAR(255),
PREMLOCATIONFREETEXTDESCRIPTOR VARCHAR(255) ,
PREMSECONDADDRESABLEOBJECT VARCHAR(255) ,
PREMPRIMARYADDRESSABLEOBJECT VARCHAR(100) ,
PREMADDRESSLINE01 VARCHAR(60) CONSTRAINT CH01_ADDRESSLINE01 NOT NULL,
PREMADDRESSLINE02 VARCHAR(60) ,
PREMADDRESSLINE03 VARCHAR(60) ,
PREMADDRESSLINE04 VARCHAR(60) ,
PREMADDRESSLINE05 VARCHAR(60) ,
PREMPOSTCODE VARCHAR(8) CONSTRAINT CH01_POSTCODE NOT NULL,
PREMPAFADDRESSKEY NUMBER(9) ,
CUSTLOCATIONFREETEXTDESCRIPTOR VARCHAR(255) ,
CUSTSECONDADDRESABLEOBJECT VARCHAR(255) ,
CUSTPRIMARYADDRESSABLEOBJECT VARCHAR(100) ,
CUSTADDRESSLINE01 VARCHAR(60) CONSTRAINT CH02_ADDRESSLINE01 NOT NULL,
CUSTADDRESSLINE02 VARCHAR(60) ,
CUSTADDRESSLINE03 VARCHAR(60) ,
CUSTADDRESSLINE04 VARCHAR(60) ,
CUSTADDRESSLINE05 VARCHAR(60) ,
CUSTPOSTCODE VARCHAR(8) CONSTRAINT CH02_POSTCODE NOT NULL,
CUSTCOUNTRY VARCHAR(32) ,
CUSTPAFADDRESSKEY NUMBER(9)
);

ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT PK_SPID PRIMARY KEY (SPID_PK);
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_SERVICECATEGORY CHECK (SERVICECATEGORY IN ('W','S'));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_PAIRINGREFREASONCODE CHECK (PAIRINGREFREASONCODE IN ('NOSPID', 'NOTELIGIBLE'));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_MULTIPLEWHOLESALERFLAG CHECK (MULTIPLEWHOLESALERFLAG IN (0,1));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_DISCONRECONDEREGSTATUS CHECK (DISCONRECONDEREGSTATUS IN ('TDISC','REC'));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_OCCUPENCYSTATUS CHECK (OCCUPENCYSTATUS IN ('OCCUPIED', 'VACANT'));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_VOABAREFRSNCODE CHECK (VOABAREFRSNCODE IN ('NR','ME','AG','SR','MT','IP','SP','OT'));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_BUILDINGWATERSTATUS CHECK (BUILDINGWATERSTATUS IN (0,1));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_NONPUBHEALTHRELSITE  CHECK (NONPUBHEALTHRELSITE  IN (0,1));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_PUBHEALTHRELSITEARR CHECK (PUBHEALTHRELSITEARR IN (0,1));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_UPRNREASONCODE CHECK (UPRNREASONCODE IN ('ME','SR','MT','IP','PL','BW','SP','OT'));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_CUSTOMERCLASSIFICATION CHECK (CUSTOMERCLASSIFICATION IN ('SEMDV', 'NA'));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT RF01_STDINDUSTRYCLASSCODETYPE CHECK (STDINDUSTRYCLASSCODETYPE IN ('1980', '1992', '2003', '2007'));

ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT CH01_PAIRING_WHOLESALER CHECK ((PAIRINGREFREASONCODE IS NOT NULL AND OTHERWHOLESALERID IS NULL) OR (PAIRINGREFREASONCODE IS NULL AND OTHERWHOLESALERID IS NOT NULL));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT CH01_VOABAREF_CODE CHECK ((VOABAREFERENCE IS NULL AND VOABAREFRSNCODE IS NULL) OR (VOABAREFERENCE IS NOT NULL AND VOABAREFRSNCODE IS NULL) OR (VOABAREFERENCE IS NULL AND VOABAREFRSNCODE IS NOT NULL));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT CH01_UPRN_REASON CHECK ((UPRN IS NOT NULL AND UPRNREASONCODE IS NULL) OR (UPRN IS NULL AND UPRNREASONCODE IS NOT NULL));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT CH01_NONPUBHEALTHRELSITE_DSC CHECK ((NONPUBHEALTHRELSITE = 1 AND NONPUBHEALTHRELSITEDSC IS NOT NULL) OR (NONPUBHEALTHRELSITE = 0 AND NONPUBHEALTHRELSITEDSC IS NULL));
ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT CH01_STDINDUSTRYCLASSCODE_TYPE CHECK ((STDINDUSTRYCLASSCODE IS NOT NULL AND STDINDUSTRYCLASSCODETYPE IS NOT NULL) OR (STDINDUSTRYCLASSCODE IS NULL AND STDINDUSTRYCLASSCODETYPE IS NULL));
--ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT CH01_CUSTPOSTCODE CHECK ((LENGTH(TRIM(CUSTPOSTCODE)) - INSTR(TRIM(CUSTPOSTCODE),' ') = 3) AND (REGEXP_COUNT(TRIM(CUSTPOSTCODE),' ') = 1));
--ALTER TABLE DEL_SUPPLY_POINT ADD CONSTRAINT CH01_PREMPOSTCODE CHECK ((LENGTH(TRIM(PREMPOSTCODE)) - INSTR(TRIM(PREMPOSTCODE),' ') = 3) AND (REGEXP_COUNT(TRIM(PREMPOSTCODE),' ') = 1));

COMMENT ON TABLE DEL_SUPPLY_POINT IS 'Supply Point---The  provision of a water or sewer service at an Eligible Premise for a period of time. Each Eligible Premise has either one or two Supply Points at any point in time (no more than two); i.e. it can have either a water Supply Point, a sewerage Supply Point or both. The Supply Point is the tradeable item within the competitive water market in England and Wales; i.e. it is the level at which the end consumer can choose their retailer and therefore over time can be switched between retailers. The water and sewerage Supply Points at an Eligible Premise are independent in regards to both retailers and wholesalers; i.e. at any point in time the water and sewerage Supply Points at an Eligible Premise can have different Wholesalers and Retailers. ';
COMMENT ON COLUMN DEL_SUPPLY_POINT.SPID_PK IS 'SPID~~~D2001 - Unique identifier allocated to each Supply Point by the Market Operator';
COMMENT ON COLUMN DEL_SUPPLY_POINT.WHOLESALERID IS 'Wholesaler ID~~~D4025 - Trading Party ID for the wholesaler supplying the data upload file';
COMMENT ON COLUMN DEL_SUPPLY_POINT.RETAILERID IS 'Retailer ID~~~D4011 - Trading Party ID for a retailer';
COMMENT ON COLUMN DEL_SUPPLY_POINT.SERVICECATEGORY IS 'Service Category~~~D2002 - Identifies the Service Category for a Supply Point (Water Services or Sewerage Services) “W” = Water and “S” = Sewerage';
COMMENT ON COLUMN DEL_SUPPLY_POINT.SUPPLYPOINTEFFECTIVEFROMDATE IS 'Supply Point Effective From Date~~~D2013 - Date that the Supply Point takes effect in the Central Systems.  This can be the date the connection was completed for newly established Supply Points, or the date that a Gap Site of Entry Change of Use takes effect.';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PAIRINGREFREASONCODE IS 'Pairing Reference Reason Code~~~D2086 - Reason code for the absence of a pairing reference when requesting a new SPID. Must be populated with “NOSPID” if there is no pair for this Supply Point, otherwise it must be unpopulated';
COMMENT ON COLUMN DEL_SUPPLY_POINT.OTHERWHOLESALERID IS 'Other Wholesaler ID~~~D4018 - Unique ID identifying the Other Wholesaler i.e. the wholesale provider of services of the other Service Category at an Eligible Premises.';
COMMENT ON COLUMN DEL_SUPPLY_POINT.MULTIPLEWHOLESALERFLAG IS 'Multiple Wholesalers Flag~~~D2053 - Boolean flag to indicate that there are multiple wholesalers for the same category of SPID at one site (where only the lead wholesaler is identified in the market and associated with the SPID)';
COMMENT ON COLUMN DEL_SUPPLY_POINT.DISCONRECONDEREGSTATUS IS 'Disconnection/Reconnection/Deregistration~~~D2025 - Declares a Supply Point Disconnection, Reconnection or Deregistration. Also enables the distinction between a Temporary Disconnection and a Permanent Disconnection. Must contain “TDISC” if Supply Point is temporarily disconnected, otherwise must be unpopulated';
COMMENT ON COLUMN DEL_SUPPLY_POINT.LANDLORDSPID IS 'Landlord SPID~~~D2070 - Identifies the Landlord Supply point in a multi-occupancy Eligible Premises.  The valid set for this is all SPIDs';
COMMENT ON COLUMN DEL_SUPPLY_POINT.VOABAREFERENCE IS 'VOA BA Reference~~~D2037 - Valuation Office Agency Billing Authority Reference Number';
COMMENT ON COLUMN DEL_SUPPLY_POINT.VOABAREFRSNCODE IS 'VOA BA Reference Reason Code~~~D2038 - Code to explain the absence or duplication of a Valuation Office Agency Billing Authority Reference. (in valid set)';
COMMENT ON COLUMN DEL_SUPPLY_POINT.UPRN IS 'UPRN~~~D2039 - Unique Property Reference Number (UPRN) as published in the NLPG';
COMMENT ON COLUMN DEL_SUPPLY_POINT.UPRNREASONCODE IS 'UPRN Reason Code~~~D2040 - Code to explain the absence or duplicate of a UPRN (in valid set)';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PUBHEALTHRELSITEARR IS 'Public Health Related Site Specific Arrangements Flag~~~D2087 - Boolean flag to Indicate whether or not a site specific management plan is in place for public health related reasons';
COMMENT ON COLUMN DEL_SUPPLY_POINT.NONPUBHEALTHRELSITE  IS 'Non-Public Health Related Site Specific Arrangements Flag~~~D2093 - Indication of whether or not a site specific management plan is in place, and not for public health related reasons';
COMMENT ON COLUMN DEL_SUPPLY_POINT.NONPUBHEALTHRELSITEDSC IS 'Non-Public Health Related Site Specific Arrangements Free Descriptor~~~D2094 - Free descriptor for indication of the nature of site specific management plan in place, when not for public health related reasons';
COMMENT ON COLUMN DEL_SUPPLY_POINT.OCCUPENCYSTATUS IS 'Occupancy Status~~~D2015 - Declares premises for the SPID as Vacant or Occupied';
COMMENT ON COLUMN DEL_SUPPLY_POINT.BUILDINGWATERSTATUS IS 'Building Water Status~~~D2029 - Boolean flag to indicate if the site is a building construction site. ';
COMMENT ON COLUMN DEL_SUPPLY_POINT.SECTION154 IS 'Section 154A Dwelling Units~~~D2074 - The number of dwelling units at an Eligible Premises that are eligible to receive Section 154A payments under the Water Industry Act 1991';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTOMERCLASSIFICATION IS 'Customer Classification~~~D2005 - Customer classification for a Supply Point, for identification of where a customer is defined as vulnerable for the purposes of the Security and Emergency Measures (Water and Sewerage Undertakers) Directions ';
COMMENT ON COLUMN DEL_SUPPLY_POINT.STDINDUSTRYCLASSCODE IS 'Standard Industrial Classification Code~~~D2008 - Standard Industrial Classification Code applicable to a Supply Point';
COMMENT ON COLUMN DEL_SUPPLY_POINT.STDINDUSTRYCLASSCODETYPE IS 'Standard Industrial Classification Code Type~~~D2092 - Identifies the version of the Standard Industrial Classification Code provided';
COMMENT ON COLUMN DEL_SUPPLY_POINT.RATEABLEVALUE IS 'Rateable Value~~~D2011 - Rateable Value of Eligible Premises in £';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTOMERNAME IS 'Customer Name~~~D2027 - The customer name associated with a given Supply Point';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTOMERBANNERNAME IS 'Customer Banner Name~~~D2050 - The Trading Name of the Customer at a given Eligible Premises, if known';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PREMLOCATIONFREETEXTDESCRIPTOR IS 'Free Descriptor~~~D5001 - Premises Free text descriptor for address/location  details';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PREMSECONDADDRESABLEOBJECT IS '~~~D5002 - Premises BS7666 Secondary Addressable Object if available';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PREMPRIMARYADDRESSABLEOBJECT IS '~~~D5003 - Premises BS7666 Primary Addressable Object if available';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PREMADDRESSLINE01 IS 'Address Line 1~~~D5004 - Premises First line of address, or first line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PREMADDRESSLINE02 IS 'Address Line 2~~~D5005 - Premises Second line of address, or second line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PREMADDRESSLINE03 IS 'Address Line 3~~~D5006 - Premises Third line of address, or third line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PREMADDRESSLINE04 IS 'Address Line 4~~~D5007 - Premises Fourth line of address, or fourth line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PREMADDRESSLINE05 IS 'Address Line 5~~~D5008 - Premises Fifth line of address, or fifth line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PREMPOSTCODE IS 'Postcode~~~D5009 - Premises Postcode (without spaces)';
COMMENT ON COLUMN DEL_SUPPLY_POINT.PREMPAFADDRESSKEY IS 'PAF Address Key~~~D5011 - Premises PAF Address Key if known';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTLOCATIONFREETEXTDESCRIPTOR IS 'Free Descriptor~~~D5001 - Customer Free text descriptor for address/location  details';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTSECONDADDRESABLEOBJECT IS '~~~D5002 - Customer BS7666 Secondary Addressable Object if available';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTPRIMARYADDRESSABLEOBJECT IS '~~~D5003 - Customer BS7666 Primary Addressable Object if available';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTADDRESSLINE01 IS 'Address Line 1~~~D5004 - Customer First line of address, or first line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTADDRESSLINE02 IS 'Address Line 2~~~D5005 - Customer Second line of address, or second line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTADDRESSLINE03 IS 'Address Line 3~~~D5006 - Customer Third line of address, or third line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTADDRESSLINE04 IS 'Address Line 4~~~D5007 - Customer Fourth line of address, or fourth line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTADDRESSLINE05 IS 'Address Line 5~~~D5008 - Customer Fifth line of address, or fifth line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTPOSTCODE IS 'Postcode~~~D5009 - Customer Postcode (without spaces)';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTCOUNTRY IS 'Country~~~D5010 - Customer Country, if address is outside the UK';
COMMENT ON COLUMN DEL_SUPPLY_POINT.CUSTPAFADDRESSKEY IS 'PAF Address Key~~~D5011 - Customer PAF Address Key if known';

CREATE TABLE DEL_SERVICE_COMPONENT
(
SPID_PK VARCHAR(13)  CONSTRAINT CH01_SPID NOT NULL ,
-- METERED POTABLE WATER
METEREDPWTARIFFCODE VARCHAR(32) ,
MPWSPECIALAGREEMENTFLAG NUMBER(1) ,
MPWSPECIALAGREEMENTFACTOR NUMBER(2,2) ,
MPWSPECIALAGREEMENTREF VARCHAR(12) ,
METEREDPWMAXDAILYDEMAND NUMBER(12) ,
MPWMAXIMUMDEMANDTARIFF NUMBER(9,2),
DAILYRESERVEDCAPACITY NUMBER(12) ,
MPWDAILYSTANDBYUSAGEVOLCHARGE NUMBER(9,2),
-- METERED NON-POTABLE WATER
METEREDNPWTARIFFCODE VARCHAR(32) ,
MNPWSPECIALAGREEMENTFLAG NUMBER(1) ,
MNPWSPECIALAGREEMENTFACTOR NUMBER(2,2) ,
MNPWSPECIALAGREEMENTREF VARCHAR(12) ,
METEREDNPWMAXDAILYDEMAND NUMBER(12) ,
MNPWMAXIMUMDEMANDTARIFF NUMBER(9,2) ,
METEREDNPWDAILYRESVDCAPACITY NUMBER(12) ,
MNPWDAILYSTANDBYUSAGEVOLCHARGE NUMBER(9,2),
-- ASSESSED WATER
AWASSESSEDTARIFFCODE VARCHAR(32) ,
AWSPECIALAGREEMENTFLAG NUMBER(1) ,
AWSPECIALAGREEMENTFACTOR NUMBER(2,2) ,
AWSPECIALAGREEMENTREF VARCHAR(12) ,
AWASSESSEDCHARGEMETERSIZE NUMBER(4) ,
AWASSESSEDDVOLUMETRICRATE NUMBER(12) ,
AWASSESSEDTARIFBAND NUMBER(2) ,
AWFIXEDCHARGE NUMBER(9,2),
AWVOLUMETRICCHARGE NUMBER(9,2),
AWTARIFFBAND NUMBER,
-- UNMEASURED WATER
UWUNMEASUREDTARIFFCODE VARCHAR(32) ,
UWSPECIALAGREEMENTFLAG NUMBER(1) ,
UWSPECIALAGREEMENTFACTOR NUMBER(2,2) ,
UWSPECIALAGREEMENTREF VARCHAR(12) ,
UWUNMEASUREDTYPEACOUNT NUMBER(3) ,
UWUNMEASUREDTYPEADESCRIPTION VARCHAR(255) ,
UWUNMEASUREDTYPEBCOUNT NUMBER(3) ,
UWUNMEASUREDTYPEBDESCRIPTION VARCHAR(255) ,
UWUNMEASUREDTYPECCOUNT NUMBER(3) ,
UWUNMEASUREDTYPECDESCRIPTION VARCHAR(255) ,
UWUNMEASUREDTYPEDCOUNT NUMBER(3) ,
UWUNMEASUREDTYPEDDESCRIPTION VARCHAR(255) ,
UWUNMEASUREDTYPEECOUNT NUMBER(3) ,
UWUNMEASUREDTYPEEDESCRIPTION VARCHAR(255) ,
UWUNMEASUREDTYPEFCOUNT NUMBER(3) ,
UWUNMEASUREDTYPEFDESCRIPTION VARCHAR(255) ,
UWUNMEASUREDTYPEGCOUNT NUMBER(3) ,
UWUNMEASUREDTYPEGDESCRIPTION VARCHAR(255) ,
UWUNMEASUREDTYPEHCOUNT NUMBER(3) ,
UWUNMEASUREDTYPEHDESCRIPTION VARCHAR(255) ,
UWPIPESIZE NUMBER(4,0) ,
-- CHARGE ADJUSTMENT WATER
WADJCHARGEADJTARIFFCODE VARCHAR(32) ,
-- METERED FOUL SEWERAGE
METEREDFSTARIFFCODE VARCHAR(32) ,
MFSSPECIALAGREEMENTFLAG NUMBER(1) ,
MFSSPECIALAGREEMENTFACTOR NUMBER(2,2) ,
MFSSPECIALAGREEMENTREF VARCHAR(12) ,
-- ASSESSED SEWERAGE
ASASSESSEDTARIFFCODE VARCHAR(32) ,
ASSPECIALAGREEMENTFLAG NUMBER(1) ,
ASSPECIALAGREEMENTFACTOR NUMBER(2,2) ,
ASSPECIALAGREEMENTREF VARCHAR(12) ,
ASASSESSEDCHARGEMETERSIZE NUMBER(4) ,
ASASSESSEDDVOLUMETRICRATE NUMBER(12) ,
ASASSESSEDTARIFBAND NUMBER(2) ,
ASFIXEDCHARGE NUMBER(9,2),
ASVOLMETCHARGE NUMBER(9,2),
ASTARIFFBAND NUMBER,
-- UNMEASURED SEWERAGE
USUNMEASUREDTARIFFCODE VARCHAR(32) ,
USSPECIALAGREEMENTFLAG NUMBER(1) ,
USSPECIALAGREEMENTFACTOR NUMBER(2,2) ,
USSPECIALAGREEMENTREF VARCHAR(12) ,
USUNMEASUREDTYPEACOUNT NUMBER(3) ,
USUNMEASUREDTYPEADESCRIPTION VARCHAR(255) ,
USUNMEASUREDTYPEBCOUNT NUMBER(3) ,
USUNMEASUREDTYPEBDESCRIPTION VARCHAR(255) ,
USUNMEASUREDTYPECCOUNT NUMBER(3) ,
USUNMEASUREDTYPECDESCRIPTION VARCHAR(255) ,
USUNMEASUREDTYPEDCOUNT NUMBER(3) ,
USUNMEASUREDTYPEDDESCRIPTION VARCHAR(255) ,
USUNMEASUREDTYPEECOUNT NUMBER(3) ,
USUNMEASUREDTYPEEDESCRIPTION VARCHAR(255) ,
USUNMEASUREDTYPEFCOUNT NUMBER(3) ,
USUNMEASUREDTYPEFDESCRIPTION VARCHAR(255) ,
USUNMEASUREDTYPEGCOUNT NUMBER(3) ,
USUNMEASUREDTYPEGDESCRIPTION VARCHAR(255) ,
USUNMEASUREDTYPEHCOUNT NUMBER(3) ,
USUNMEASUREDTYPEHDESCRIPTION VARCHAR(255) ,
USPIPESIZE NUMBER(4,0) ,
-- CHARGE ADJUSTMENT SEWERAGE
SADJCHARGEADJTARIFFCODE VARCHAR(32) ,
-- SURFACE WATER DRAINAGE
SRFCWATERTARRIFCODE VARCHAR(32) ,
SRFCWATERAREADRAINED NUMBER(12) ,
SRFCWATERCOMMUNITYCONFLAG NUMBER(1) ,
SWSPECIALAGREEMENTFLAG NUMBER(1) ,
SWSPECIALAGREEMENTFACTOR NUMBER(2,2) ,
SWSPECIALAGREEMENTREF VARCHAR(12) ,
-- HIGHWAY DRAINAGE
HWAYDRAINAGETARIFFCODE VARCHAR(32) ,
HWAYSURFACEAREA NUMBER(12) ,
HWAYCOMMUNITYCONFLAG NUMBER(1) ,
HDSPECIALAGREEMENTFLAG NUMBER(1) ,
HDSPECIALAGREEMENTFACTOR NUMBER(2,2) ,
HDSPECIALAGREEMENTREF VARCHAR(12) 
);

ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_MPWSPECIALAGREEMENTFLAG CHECK (MPWSPECIALAGREEMENTFLAG IN (0,1));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_MNPWSPECIALAGREEMENTFLAG CHECK (MNPWSPECIALAGREEMENTFLAG IN (0,1));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_AWSPECIALAGREEMENTFLAG CHECK (AWSPECIALAGREEMENTFLAG IN (0,1));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_UWSPECIALAGREEMENTFLAG CHECK (UWSPECIALAGREEMENTFLAG IN (0,1));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_MFSSPECIALAGREEMENTFLAG CHECK (MFSSPECIALAGREEMENTFLAG IN (0,1));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_ASSPECIALAGREEMENTFLAG CHECK (ASSPECIALAGREEMENTFLAG IN (0,1));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_USSPECIALAGREEMENTFLAG CHECK (USSPECIALAGREEMENTFLAG IN (0,1));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_SWSPECIALAGREEMENTFLAG CHECK (SWSPECIALAGREEMENTFLAG IN (0,1));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_HDSPECIALAGREEMENTFLAG CHECK (HDSPECIALAGREEMENTFLAG IN (0,1));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_HWAYCOMMUNITYCONFLAG CHECK (HWAYCOMMUNITYCONFLAG IN (0,1));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT RF01_SRFCWATERCOMMUNITYCONFLAG CHECK (SRFCWATERCOMMUNITYCONFLAG IN (0,1));

ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_MPWSPECIALAGREEMENTFACTOR CHECK ((METEREDPWTARIFFCODE IS NOT NULL AND MPWSPECIALAGREEMENTFLAG IS NOT NULL) OR (METEREDPWTARIFFCODE IS NULL AND MPWSPECIALAGREEMENTFLAG IS NULL));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_NPWSPECIALAGREEMENTFACTOR CHECK ((METEREDNPWTARIFFCODE IS NOT NULL AND MNPWSPECIALAGREEMENTFLAG IS NOT NULL) OR (METEREDNPWTARIFFCODE IS NULL AND MNPWSPECIALAGREEMENTFLAG IS NULL));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_AWSPECIALAGREEMENTFACTOR CHECK ((AWASSESSEDTARIFFCODE IS NOT NULL AND AWSPECIALAGREEMENTFLAG IS NOT NULL) OR (AWASSESSEDTARIFFCODE IS NULL AND AWSPECIALAGREEMENTFLAG IS NULL));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_UWSPECIALAGREEMENTFACTOR CHECK ((UWUNMEASUREDTARIFFCODE IS NOT NULL AND UWSPECIALAGREEMENTFLAG IS NOT NULL) OR (UWUNMEASUREDTARIFFCODE IS NULL AND UWSPECIALAGREEMENTFLAG IS NULL));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_MFSSPECIALAGREEMENTFACTOR CHECK ((METEREDFSTARIFFCODE IS NOT NULL AND MFSSPECIALAGREEMENTFLAG IS NOT NULL) OR (METEREDFSTARIFFCODE IS NULL AND MFSSPECIALAGREEMENTFLAG IS NULL));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_ASSPECIALAGREEMENTFACTOR CHECK ((ASASSESSEDTARIFFCODE IS NOT NULL AND ASSPECIALAGREEMENTFLAG IS NOT NULL) OR (ASASSESSEDTARIFFCODE IS NULL AND ASSPECIALAGREEMENTFLAG IS NULL));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_USSPECIALAGREEMENTFACTOR CHECK ((USUNMEASUREDTARIFFCODE IS NOT NULL AND USSPECIALAGREEMENTFLAG IS NOT NULL) OR (USUNMEASUREDTARIFFCODE IS NULL AND USSPECIALAGREEMENTFLAG IS NULL));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_SWSPECIALAGREEMENTFACTOR CHECK ((SRFCWATERTARRIFCODE IS NOT NULL AND SWSPECIALAGREEMENTFLAG IS NOT NULL) OR (SRFCWATERTARRIFCODE IS NULL AND SWSPECIALAGREEMENTFLAG IS NULL));
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_HDSPECIALAGREEMENTFACTOR CHECK ((HWAYDRAINAGETARIFFCODE IS NOT NULL AND HDSPECIALAGREEMENTFLAG IS NOT NULL) OR (HWAYDRAINAGETARIFFCODE IS NULL AND HDSPECIALAGREEMENTFLAG IS NULL));

ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_MPWUNIQUEKEY UNIQUE (SPID_PK,METEREDPWTARIFFCODE);
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_UWUNIQUEKEY UNIQUE (SPID_PK,UWUNMEASUREDTARIFFCODE);
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_ASUNIQUEKEY UNIQUE (SPID_PK,ASASSESSEDTARIFFCODE);
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_USUNIQUEKEY UNIQUE (SPID_PK,USUNMEASUREDTARIFFCODE);
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_HDUNIQUEKEY UNIQUE (SPID_PK,HWAYDRAINAGETARIFFCODE);
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_AWUNIQUEKEY UNIQUE (SPID_PK,AWASSESSEDTARIFFCODE);
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_SWUNIQUEKEY UNIQUE (SPID_PK,SRFCWATERTARRIFCODE);
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_MSUNIQUEKEY UNIQUE (SPID_PK,METEREDFSTARIFFCODE);
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_MNPWUNIQUEKEY UNIQUE (SPID_PK,METEREDNPWTARIFFCODE);
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_SCAUNIQUEKEY UNIQUE (SPID_PK,SADJCHARGEADJTARIFFCODE);
ALTER TABLE DEL_SERVICE_COMPONENT ADD CONSTRAINT CH01_WCAUNIQUEKEY UNIQUE (SPID_PK,WADJCHARGEADJTARIFFCODE);

COMMENT ON COLUMN DEL_SERVICE_COMPONENT.SPID_PK IS 'SPID~~~D2001 - Unique identifier allocated to each Supply Point by the Market Operator';
-- METERED POTABLE WATER
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.METEREDPWTARIFFCODE IS 'Metered Potable Water Tariff Code~~~D2056 - Indicates the tariff code for this Service Component to be applied at the Supply Point. The valid set for this is all Tariff Codes associated with the relevant Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.MPWSPECIALAGREEMENTFLAG IS 'Special Agreement Flag~~~D2004 - Identifies the presence of a Special Agreement at a Service Component or a DPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.MPWSPECIALAGREEMENTFACTOR IS 'Special Agreement Factor~~~D2003 - Percentage factor applied to a Service Component or a DPID where a Special Arrangement exists. When set to zero it results in a zero charge, when set to 100% no adjustment is applied, and can be set to > 100%';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.MPWSPECIALAGREEMENTREF IS 'Special Agreement Reference~~~D2090 - Ofwat Reference for any S.142(2)(b) Special Agreement in place for the Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.METEREDPWMAXDAILYDEMAND IS 'Maximum Daily Demand~~~D2079 - Maximum daily demand in m3 for a Metered Service Component, for maximum demand tariffs';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.DAILYRESERVEDCAPACITY IS 'Daily Reserved Capacity~~~D2080 - Daily reserved capacity in m3 for a Metered Service Component';
-- METERED NON-POTABLE WATER
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.METEREDNPWTARIFFCODE IS 'Metered Non-Potable Water Tariff Code~~~D2057 - Indicates the tariff code for this Service Component to be applied at the Supply Point. The valid set for this is all Tariff Codes associated with the relevant Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.MNPWSPECIALAGREEMENTFLAG IS 'Special Agreement Flag~~~D2004 - Identifies the presence of a Special Agreement at a Service Component or a DPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.MNPWSPECIALAGREEMENTFACTOR IS 'Special Agreement Factor~~~D2003 - Percentage factor applied to a Service Component or a DPID where a Special Arrangement exists. When set to zero it results in a zero charge, when set to 100% no adjustment is applied, and can be set to > 100%';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.MNPWSPECIALAGREEMENTREF IS 'Special Agreement Reference~~~D2090 - Ofwat Reference for any S.142(2)(b) Special Agreement in place for the Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.METEREDNPWMAXDAILYDEMAND IS 'Maximum Daily Demand~~~D2079 - Maximum daily demand in m3 for a Metered Service Component, for maximum demand tariffs';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.METEREDNPWDAILYRESVDCAPACITY IS 'Daily Reserved Capacity~~~D2080 - Daily reserved capacity in m3 for a Metered Service Component';
-- ASSESSED WATER
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.AWASSESSEDTARIFFCODE IS 'Assessed Tariff Code~~~D2066 - Indicates the tariff code for this Service Component to be applied at the Supply Point. The valid set for this is all Tariff Codes associated with the relevant Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.AWSPECIALAGREEMENTFLAG IS 'Special Agreement Flag~~~D2004 - Identifies the presence of a Special Agreement at a Service Component or a DPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.AWSPECIALAGREEMENTFACTOR IS 'Special Agreement Factor~~~D2003 - Percentage factor applied to a Service Component or a DPID where a Special Arrangement exists. When set to zero it results in a zero charge, when set to 100% no adjustment is applied, and can be set to > 100%';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.AWSPECIALAGREEMENTREF IS 'Special Agreement Reference~~~D2090 - Ofwat Reference for any S.142(2)(b) Special Agreement in place for the Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.AWASSESSEDCHARGEMETERSIZE IS 'Assessed Chargeable Meter Size~~~D2068 - Meter size in mm for charge calculation purposes, for Assessed Service Components';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.AWASSESSEDDVOLUMETRICRATE IS 'Assessed Volumetric Rate~~~D2049 - The Volume (in m3 per year) to be used in charge calculations for Assessed Service Components';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.AWASSESSEDTARIFBAND IS 'Tariff band~~~D2081 - Tariff band number to be applied for Service Components where banded tariffs are permitted';
-- UNMEASURED WATER
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTARIFFCODE IS 'Unmeasured Tariff Code~~~D2067 - Indicates the tariff code for this Service Component to be applied at the Supply Point.  The valid set for this is all Tariff Codes associated with the relevant Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWSPECIALAGREEMENTFLAG IS 'Special Agreement Flag~~~D2004 - Identifies the presence of a Special Agreement at a Service Component or a DPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWSPECIALAGREEMENTFACTOR IS 'Special Agreement Factor~~~D2003 - Percentage factor applied to a Service Component or a DPID where a Special Arrangement exists. When set to zero it results in a zero charge, when set to 100% no adjustment is applied, and can be set to > 100%';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWSPECIALAGREEMENTREF IS 'Special Agreement Reference~~~D2090 - Ofwat Reference for any S.142(2)(b) Special Agreement in place for the Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEACOUNT IS 'Unmeasured Items Type A Count~~~D2018 - Indicates how many of Unmeasured Items Type A are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEADESCRIPTION IS 'Unmeasured Items Type A Description~~~D2058 - Free text description of the Unmeasured Items of Type A applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEBCOUNT IS 'Unmeasured Items Type B Count~~~D2019 - Indicates how many of Unmeasured Items Type B are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEBDESCRIPTION IS 'Unmeasured Items Type B Description~~~D2059 - Free text description of the Unmeasured Items of Type B applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPECCOUNT IS 'Unmeasured Items Type C Count~~~D2020 - Indicates how many of Unmeasured Items Type C are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPECDESCRIPTION IS 'Unmeasured Items Type C Description~~~D2060 - Free text description of the Unmeasured Items of Type C applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEDCOUNT IS 'Unmeasured Items Type D Count~~~D2021 - Indicates how many of Unmeasured Items Type D are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEDDESCRIPTION IS 'Unmeasured Items Type D Description~~~D2061 - Free text description of the Unmeasured Items of Type D applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEECOUNT IS 'Unmeasured Items Type E Count~~~D2022 - Indicates how many of Unmeasured Items Type E are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEEDESCRIPTION IS 'Unmeasured Items Type E Description~~~D2062 - Free text description of the Unmeasured Items of Type E applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEFCOUNT IS 'Unmeasured Items Type F Count~~~D2024 - Indicates how many of Unmeasured Items Type F are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEFDESCRIPTION IS 'Unmeasured Items Type F Description~~~D2064 - Free text description of the Unmeasured Items of Type F applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEGCOUNT IS 'Unmeasured Items Type G Count~~~D2046 - Indicates how many of Unmeasured Items Type G are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEGDESCRIPTION IS 'Unmeasured Items Type G Description~~~D2065 - Free text description of the Unmeasured Items of Type F applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEHCOUNT IS 'Unmeasured Items Type H Count~~~D2048 - Indicates how many of Unmeasured Items Type H are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.UWUNMEASUREDTYPEHDESCRIPTION IS 'Unmeasured Items Type H Description~~~D2069 - Free text description of the Unmeasured Items of Type H applied to the SPID';
-- => D2071 MISSING 
-- CHARGE ADJUSTMENT WATER
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.WADJCHARGEADJTARIFFCODE IS 'Charge Adjustment Tariff Code~~~D2051 - Indicates the tariff code for this Service Component to be applied at the Supply Point';
-- METERED FOUL SEWERAGE
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.METEREDFSTARIFFCODE IS 'Metered Foul Sewerage Tariff Code~~~D2063 - Indicates the tariff code for this Service Component to be applied at the Supply Point. The valid set for this is all Tariff Codes associated with the relevant Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.MFSSPECIALAGREEMENTFLAG IS 'Special Agreement Flag~~~D2004 - Identifies the presence of a Special Agreement at a Service Component or a DPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.MFSSPECIALAGREEMENTFACTOR IS 'Special Agreement Factor~~~D2003 - Percentage factor applied to a Service Component or a DPID where a Special Arrangement exists. When set to zero it results in a zero charge, when set to 100% no adjustment is applied, and can be set to > 100%';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.MFSSPECIALAGREEMENTREF IS 'Special Agreement Reference~~~D2090 - Ofwat Reference for any S.142(2)(b) Special Agreement in place for the Service Component';
-- ASSESSED SEWERAGE
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.ASASSESSEDTARIFFCODE IS 'Assessed Tariff Code~~~D2066 - Indicates the tariff code for this Service Component to be applied at the Supply Point. The valid set for this is all Tariff Codes associated with the relevant Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.ASSPECIALAGREEMENTFLAG IS 'Special Agreement Flag~~~D2004 - Identifies the presence of a Special Agreement at a Service Component or a DPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.ASSPECIALAGREEMENTFACTOR IS 'Special Agreement Factor~~~D2003 - Percentage factor applied to a Service Component or a DPID where a Special Arrangement exists. When set to zero it results in a zero charge, when set to 100% no adjustment is applied, and can be set to > 100%';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.ASSPECIALAGREEMENTREF IS 'Special Agreement Reference~~~D2090 - Ofwat Reference for any S.142(2)(b) Special Agreement in place for the Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.ASASSESSEDCHARGEMETERSIZE IS 'Assessed Chargeable Meter Size~~~D2068 - Meter size in mm for charge calculation purposes, for Assessed Service Components';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.ASASSESSEDDVOLUMETRICRATE IS 'Assessed Volumetric Rate~~~D2049 - The Volume (in m3 per year) to be used in charge calculations for Assessed Service Components';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.ASASSESSEDTARIFBAND IS 'Tariff band~~~D2081 - Tariff band number to be applied for Service Components where banded tariffs are permitted';
-- UNMEASURED SEWERAGE
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTARIFFCODE IS 'Unmeasured Tariff Code~~~D2067 - Indicates the tariff code for this Service Component to be applied at the Supply Point.  The valid set for this is all Tariff Codes associated with the relevant Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USSPECIALAGREEMENTFLAG IS 'Special Agreement Flag~~~D2004 - Identifies the presence of a Special Agreement at a Service Component or a DPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USSPECIALAGREEMENTFACTOR IS 'Special Agreement Factor~~~D2003 - Percentage factor applied to a Service Component or a DPID where a Special Arrangement exists. When set to zero it results in a zero charge, when set to 100% no adjustment is applied, and can be set to > 100%';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USSPECIALAGREEMENTREF IS 'Special Agreement Reference~~~D2090 - Ofwat Reference for any S.142(2)(b) Special Agreement in place for the Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEACOUNT IS 'Unmeasured Items Type A Count~~~D2018 - Indicates how many of Unmeasured Items Type A are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEADESCRIPTION IS 'Unmeasured Items Type A Description~~~D2058 - Free text description of the Unmeasured Items of Type A applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEBCOUNT IS 'Unmeasured Items Type B Count~~~D2019 - Indicates how many of Unmeasured Items Type B are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEBDESCRIPTION IS 'Unmeasured Items Type B Description~~~D2059 - Free text description of the Unmeasured Items of Type B applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPECCOUNT IS 'Unmeasured Items Type C Count~~~D2020 - Indicates how many of Unmeasured Items Type C are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPECDESCRIPTION IS 'Unmeasured Items Type C Description~~~D2060 - Free text description of the Unmeasured Items of Type C applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEDCOUNT IS 'Unmeasured Items Type D Count~~~D2021 - Indicates how many of Unmeasured Items Type D are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEDDESCRIPTION IS 'Unmeasured Items Type D Description~~~D2061 - Free text description of the Unmeasured Items of Type D applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEECOUNT IS 'Unmeasured Items Type E Count~~~D2022 - Indicates how many of Unmeasured Items Type E are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEEDESCRIPTION IS 'Unmeasured Items Type E Description~~~D2062 - Free text description of the Unmeasured Items of Type E applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEFCOUNT IS 'Unmeasured Items Type F Count~~~D2024 - Indicates how many of Unmeasured Items Type F are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEFDESCRIPTION IS 'Unmeasured Items Type F Description~~~D2064 - Free text description of the Unmeasured Items of Type F applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEGCOUNT IS 'Unmeasured Items Type G Count~~~D2046 - Indicates how many of Unmeasured Items Type G are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEGDESCRIPTION IS 'Unmeasured Items Type G Description~~~D2065 - Free text description of the Unmeasured Items of Type F applied to the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEHCOUNT IS 'Unmeasured Items Type H Count~~~D2048 - Indicates how many of Unmeasured Items Type H are present at the SPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.USUNMEASUREDTYPEHDESCRIPTION IS 'Unmeasured Items Type H Description~~~D2069 - Free text description of the Unmeasured Items of Type H applied to the SPID';
-- => D2071 MISSING 
-- CHARGE ADJUSTMENT SEWERAGE
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.SADJCHARGEADJTARIFFCODE IS 'Charge Adjustment Tariff Code~~~D2051 - Indicates the tariff code for this Service Component to be applied at the Supply Point';
-- SURFACE WATER DRAINAGE
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.SRFCWATERTARRIFCODE IS 'Surface Water Tariff Code~~~D2016 - Indicates the tariff code for this Service Component to be applied at the Supply Point.  The valid set for this is all Tariff Codes associated with the relevant Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.SRFCWATERAREADRAINED IS 'Area drained~~~D2078 - Area drained at the Eligible Premises in m2, for the purposes of calculating Surface Water drainage charges';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.SRFCWATERCOMMUNITYCONFLAG IS 'Community Concession Flag~~~D2085 - Boolean Flag indicating if Community Concession is to be applied to a Surface Water or Highway Drainage Service Component.';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.SWSPECIALAGREEMENTFLAG IS 'Special Agreement Flag~~~D2004 - Identifies the presence of a Special Agreement at a Service Component or a DPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.SWSPECIALAGREEMENTFACTOR IS 'Special Agreement Factor~~~D2003 - Percentage factor applied to a Service Component or a DPID where a Special Arrangement exists. When set to zero it results in a zero charge, when set to 100% no adjustment is applied, and can be set to > 100%';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.SWSPECIALAGREEMENTREF IS 'Special Agreement Reference~~~D2090 - Ofwat Reference for any S.142(2)(b) Special Agreement in place for the Service Component';
-- HIGHWAY DRAINAGE
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.HWAYDRAINAGETARIFFCODE IS 'Highway Drainage Tariff Code~~~D2017 - Indicates the tariff code for this Service Component to be applied at the Supply Point. The valid set for this is all Tariff Codes associated with the relevant Service Component';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.HWAYSURFACEAREA IS 'Surface Area~~~D2012 - Indicates the Surface area in m2 of Eligible Premises for Highway Drainage calculations';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.HWAYCOMMUNITYCONFLAG IS 'Community Concession Flag~~~D2085 - Boolean Flag indicating if Community Concession is to be applied to a Surface Water or Highway Drainage Service Component.';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.HDSPECIALAGREEMENTFLAG IS 'Special Agreement Flag~~~D2004 - Identifies the presence of a Special Agreement at a Service Component or a DPID';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.HDSPECIALAGREEMENTFACTOR IS 'Special Agreement Factor~~~D2003 - Percentage factor applied to a Service Component or a DPID where a Special Arrangement exists. When set to zero it results in a zero charge, when set to 100% no adjustment is applied, and can be set to > 100%';
COMMENT ON COLUMN DEL_SERVICE_COMPONENT.HDSPECIALAGREEMENTREF IS 'Special Agreement Reference~~~D2090 - Ofwat Reference for any S.142(2)(b) Special Agreement in place for the Service Component';

CREATE TABLE DEL_METER
(
MANUFACTURERSERIALNUM_PK VARCHAR(32) NOT NULL,
MANUFACTURER_PK VARCHAR(32) NOT NULL,
NUMBEROFDIGITS NUMBER(1) CONSTRAINT CH01_NUMBEROFDIGITS NOT NULL,
MEASUREUNITATMETER VARCHAR(12) CONSTRAINT CH01_MEASUREUNITFREEATMETER NOT NULL,
MEASUREUNITFREEDESCRIPTOR VARCHAR(255) ,
PHYSICALMETERSIZE NUMBER(4) ,
METERREADFREQUENCY VARCHAR(1) CONSTRAINT CH01_METERREADMINFREQUENCY NOT NULL,
INITIALMETERREADDATE DATE ,
RETURNTOSEWER NUMBER(3,0) , -- updated K.Burton - value is integer from 0 to 100
WATERCHARGEMETERSIZE NUMBER(4) CONSTRAINT CH01_WATERCHARGEMETERSIZE NOT NULL,
SEWCHARGEABLEMETERSIZE NUMBER(4) ,
DATALOGGERWHOLESALER NUMBER(1) CONSTRAINT CH01_DATALOGGERWHOLESALER NOT NULL,
DATALOGGERNONWHOLESALER NUMBER(1) CONSTRAINT CH01_DATALOGGERNONWHOLESALER NOT NULL,
GPSX NUMBER(7,1) ,  -- Changed because in Oracle 6,1 only allows 5 digits before the decimal point
GPSY NUMBER(7,1) ,  -- Changed because in Oracle 6,1 only allows 5 digits before the decimal point
METERLOCFREEDESCRIPTOR VARCHAR(255) ,
METEROUTREADERGPSX NUMBER(7,1) ,  -- Changed because in Oracle 6,1 only allows 5 digits before the decimal point
METEROUTREADERGPSY NUMBER(7,1) ,  -- Changed because in Oracle 6,1 only allows 5 digits before the decimal point
OUTREADERLOCFREEDES VARCHAR(255) ,
METEROUTREADERLOCCODE VARCHAR(1) ,
METERTREATMENT VARCHAR(32) CONSTRAINT CH01_METERTREATMENT NOT NULL,
METERLOCATIONCODE VARCHAR(1) CONSTRAINT CH01_METERLOCATIONCODE NOT NULL,
COMBIMETERFLAG NUMBER(1) CONSTRAINT CH01_COMBIMETERFLAG NOT NULL,
YEARLYVOLESTIMATE NUMBER(13) ,
REMOTEREADFLAG NUMBER(1) CONSTRAINT CH01_REMOTEREADFLAG NOT NULL,
REMOTEREADTYPE VARCHAR(12) ,
OUTREADERID VARCHAR(32) ,
OUTREADERPROTOCOL VARCHAR(255) ,
LOCATIONFREETEXTDESCRIPTOR VARCHAR(255) ,
SECONDADDRESABLEOBJECT VARCHAR(100) ,
PRIMARYADDRESSABLEOBJECT VARCHAR(100) ,
ADDRESSLINE01 VARCHAR(60) CONSTRAINT CH03_ADDRESSLINE01 NOT NULL,
ADDRESSLINE02 VARCHAR(60) ,
ADDRESSLINE03 VARCHAR(60) ,
ADDRESSLINE04 VARCHAR(60) ,
ADDRESSLINE05 VARCHAR(60) ,
POSTCODE VARCHAR(8) CONSTRAINT CH03_POSTCODE NOT NULL,
COUNTRY VARCHAR(32) ,
PAFADDRESSKEY NUMBER(8) 
);

ALTER TABLE DEL_METER ADD CONSTRAINT RF01_METERTREATMENT CHECK (METERTREATMENT IN ('POTABLE', 'NONPOTABLE', 'PRIVATEWATER', 'PRIVATETE', 'SEWERAGE', 'CROSSBORDER'));
ALTER TABLE DEL_METER ADD CONSTRAINT RF01_MEASUREUNITATMETER CHECK (MEASUREUNITATMETER IN ('METRICm3', 'METRICNONm3'));
ALTER TABLE DEL_METER ADD CONSTRAINT RF01_METERREADFREQUENCY CHECK (METERREADFREQUENCY IN ('B','M'));
ALTER TABLE DEL_METER ADD CONSTRAINT RF01_DATALOGGERWHOLESALER CHECK (DATALOGGERWHOLESALER IN (0,1));
ALTER TABLE DEL_METER ADD CONSTRAINT RF01_METERLOCATIONCODE CHECK (METERLOCATIONCODE IN ('I', 'O'));
ALTER TABLE DEL_METER ADD CONSTRAINT RF01_METEROUTREADERLOCCODE CHECK (METEROUTREADERLOCCODE IN ('I', 'O'));
ALTER TABLE DEL_METER ADD CONSTRAINT RF01_COMBIMETERFLAG CHECK (COMBIMETERFLAG IN (1,0));
ALTER TABLE DEL_METER ADD CONSTRAINT RF01_REMOTEREADFLAG CHECK (REMOTEREADFLAG IN (1,0));
ALTER TABLE DEL_METER ADD CONSTRAINT RF01_REMOTEREADTYPE CHECK (REMOTEREADTYPE IN ('TOUCH', '1WAYRAD', '2WRAD', 'GPRS', 'OTHER'));

ALTER TABLE DEL_METER ADD CONSTRAINT CH01_MANUFACTURERSERIALNUM_PK CHECK (MANUFACTURERSERIALNUM_PK IS NOT NULL);
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_MANUFACTURER_PK CHECK (MANUFACTURER_PK IS NOT NULL);
ALTER TABLE DEL_METER ADD CONSTRAINT PK_MAN_SERIAL_REF_COMP PRIMARY KEY (MANUFACTURER_PK,MANUFACTURERSERIALNUM_PK);
ALTER TABLE DEL_METER ADD CONSTRAINT CH02_NUMBEROFDIGITS CHECK (NUMBEROFDIGITS >= 2 AND NUMBEROFDIGITS <= 9);
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_MEASUREUNITFREEDESCRIPTOR CHECK ((MEASUREUNITATMETER = 'METRICNONm3' AND MEASUREUNITFREEDESCRIPTOR IS NOT NULL) OR (MEASUREUNITFREEDESCRIPTOR IS NULL));
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_PHYSICALMETERSIZE CHECK (((METERTREATMENT IN ('POTABLE', 'NONPOTABLE', 'PRIVATEWATER')) AND PHYSICALMETERSIZE IS NOT NULL) OR ((METERTREATMENT NOT IN ('POTABLE', 'NONPOTABLE', 'PRIVATEWATER'))));
ALTER TABLE DEL_METER ADD CONSTRAINT RF01_DATALOGGERNONWHOLESALER CHECK (DATALOGGERNONWHOLESALER IN (0,1));
ALTER TABLE DEL_METER ADD CONSTRAINT CH02_GPSX CHECK ((GPSX >= 82644 AND GPSX <= 655612) OR (GPSX IS NULL));
ALTER TABLE DEL_METER ADD CONSTRAINT CH02_GPSY CHECK ((GPSY >= 5186 AND GPSY <= 657421) OR (GPSX IS NULL));
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_METEROUTREADERGPSX CHECK ((OUTREADERID IS NOT NULL AND METEROUTREADERGPSX IS NOT NULL) OR (OUTREADERID IS NULL));
ALTER TABLE DEL_METER ADD CONSTRAINT CH02_METEROUTREADERGPSX CHECK ((METEROUTREADERGPSX >= 82644 AND METEROUTREADERGPSX <= 655612) OR (METEROUTREADERGPSX IS NULL));
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_METEROUTREADERGPSY CHECK ((OUTREADERID IS NOT NULL AND METEROUTREADERGPSY IS NOT NULL) OR (OUTREADERID IS NULL));
ALTER TABLE DEL_METER ADD CONSTRAINT CH02_METEROUTREADERGPSY CHECK ((METEROUTREADERGPSY >= 5186 AND METEROUTREADERGPSY <= 657421) OR (METEROUTREADERGPSY IS NULL));
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_YEARLYVOLESTIMATE CHECK (((METERTREATMENT IN ('SEWERAGE', 'PRIVATETE', 'PRIVATEWATER')) AND YEARLYVOLESTIMATE IS NOT NULL) OR ((METERTREATMENT NOT IN ('SEWERAGE', 'PRIVATETE', 'PRIVATEWATER'))));
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_REMOTEREADTYPE CHECK ((REMOTEREADFLAG = 1 AND REMOTEREADTYPE IS NOT NULL) OR (REMOTEREADTYPE IS NULL));
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_OUTREADERID CHECK ((REMOTEREADFLAG = 1 AND OUTREADERID IS NOT NULL) OR (OUTREADERID IS NULL));
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_OUTREADERPROTOCOL CHECK ((REMOTEREADFLAG = 1 AND OUTREADERPROTOCOL IS NOT NULL) OR (OUTREADERPROTOCOL IS NULL));
-- Add constraint to check RETURNTOSEWER is populated if associated with Sewerage SPID
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_RETURNTOSEWER CHECK ((METERTREATMENT = 'SEWERAGE' AND RETURNTOSEWER IS NOT NULL ) OR (METERTREATMENT <> 'SEWERAGE'));
-- Add constraint to check WATERCHARGEMETERSIZE is populated if associated with Water SPID
ALTER TABLE DEL_METER ADD CONSTRAINT CH02_WATERCHARGEMETERSIZE CHECK ((METERTREATMENT = 'POTABLE' AND WATERCHARGEMETERSIZE IS NOT NULL ) OR (METERTREATMENT <> 'SEWERAGE'));
-- Add constraint to check SEWCHARGEABLEMETERSIZE is populated if associated with Sewerage SPID
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_SEWCHARGEABLEMETERSIZE CHECK ((METERTREATMENT = 'SEWERAGE' AND SEWCHARGEABLEMETERSIZE IS NOT NULL ) OR (METERTREATMENT <> 'SEWERAGE'));
-- Add constraint to set GISX mandatory
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_GPSX CHECK (GPSX IS NOT NULL);
-- Add constraint to set GISY mandatory
ALTER TABLE DEL_METER ADD CONSTRAINT CH01_GPSY CHECK (GPSY IS NOT NULL);
-- Add constraint to set METEROUTREADERLOCCODE mandatory - K.Burton removed - this item is conditional
--ALTER TABLE DEL_METER ADD CONSTRAINT CH01_METEROUTREADERLOCCODE CHECK (METEROUTREADERLOCCODE IS NOT NULL);


COMMENT ON TABLE DEL_METER IS 'Meter---A physical device used to measure water or sewerage.';
COMMENT ON COLUMN DEL_METER.MANUFACTURERSERIALNUM_PK IS 'Manufacturer Meter Serial Number~~~D3014 - Specifies the manufacturer’s serial number of a meter. STW011 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Serial field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER.MANUFACTURER_PK IS 'Meter Manufacturer~~~D3013 - Specifies the make and/or manufacturer of a meter.  STW010 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Manufacturer field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER.NUMBEROFDIGITS IS 'Number of Digits~~~D3004 - The number of digits required to provide a reading in m3. For the avoidance of doubt, this is irrespective of the actual number of dials or digits on the meter, as meters may record volumes to a higher or lower resolution than 1m3. However, this Data Item is required with reference to m3 for the purposes of rollover detection. This will also be the number of digits required for the maximum volume in m3 that can be recorded by the meter';
COMMENT ON COLUMN DEL_METER.MEASUREUNITATMETER IS 'Measurement Units at Meter~~~D3036 - Indicates the measurement units of the meter itself';
COMMENT ON COLUMN DEL_METER.MEASUREUNITFREEDESCRIPTOR IS 'Measurement Units Free Descriptor~~~D3035 - Free descriptor to provide further information on the measurements  units of the meter e.g. if the meter is a x10 meter';
COMMENT ON COLUMN DEL_METER.PHYSICALMETERSIZE IS 'Physical Meter Size~~~D3003 - Nominal size of the meter in mm e.g. for a DN15 meter the Physical Meter Size is 15';
COMMENT ON COLUMN DEL_METER.METERREADFREQUENCY IS 'Meter Read Minimum Frequency~~~D3011 - The minimum frequency with which the Retailer must read a meter';
COMMENT ON COLUMN DEL_METER.INITIALMETERREADDATE IS 'Initial Meter Read Date~~~D3042 - Date of Initial meter read, used only to uniquely identify the meter in data correction transactions';
COMMENT ON COLUMN DEL_METER.RETURNTOSEWER IS 'Return to Sewer~~~D3007 - The fraction of the volume which is deemed to return to sewer for a particular meter in %';
COMMENT ON COLUMN DEL_METER.WATERCHARGEMETERSIZE IS 'Water Chargeable Meter Size~~~D3002 - Meter size for Water Services tariff charge calculation purposes in mm. In most cases this will equal physical meter size';
COMMENT ON COLUMN DEL_METER.SEWCHARGEABLEMETERSIZE IS 'Sewerage Chargeable Meter Size~~~D3005 - Meter size for Foul Sewerage Services tariff charge calculation purposes in mm';
COMMENT ON COLUMN DEL_METER.DATALOGGERWHOLESALER IS 'Datalogger (Wholesaler)~~~D3015 - Specifies the presence of a Wholesaler datalogger';
COMMENT ON COLUMN DEL_METER.DATALOGGERNONWHOLESALER IS 'Datalogger (Non-Wholesaler)~~~D3016 - Specifies the presence of a non-Wholesaler datalogger';
COMMENT ON COLUMN DEL_METER.GPSX IS 'GISX~~~D3017 - Specifies the X coordinate of the location of the meter, in OSGB all numeric eastings from south west corner of SV square. This must be submitted to a resolution of 0.1m, however the measurement does not need to be to an accuracy of 0.1m.';
COMMENT ON COLUMN DEL_METER.GPSY IS 'GISY~~~D3018 - Specifies the Y coordinate of the location of the meter, in OSGB all numeric eastings from south west corner of SV square. This must be submitted to a resolution of 0.1m, however the measurement does not need to be to an accuracy of 0.1m.';
COMMENT ON COLUMN DEL_METER.METERLOCFREEDESCRIPTOR IS 'Meter Location Free Descriptor~~~D3019 - Retailers Free Descriptor of the location of the meter.';
COMMENT ON COLUMN DEL_METER.METEROUTREADERGPSX IS 'Meter Outreader GISX~~~D3030 - Specifies the X coordinate of the location of the meter outreader, in OSGB all numeric eastings from south west corner of SV square. This must be submitted to a resolution of 0.1m, however the measurement does not need to be to an accuracy of 0.1m.';
COMMENT ON COLUMN DEL_METER.METEROUTREADERGPSY IS 'Meter Outreader GISY~~~D3031 - Specifies the Y coordinate of the location of the meter outreader, in OSGB all numeric eastings from south west corner of SV square. This must be submitted to a resolution of 0.1m, however the measurement does not need to be to an accuracy of 0.1m.';
COMMENT ON COLUMN DEL_METER.OUTREADERLOCFREEDES IS 'Meter Outreader Location Free Descriptor~~~D3032 - Retailers Free Descriptor for the location of the outreader. Can be provided by the Wholesaler on initial setup of the outreader.';
COMMENT ON COLUMN DEL_METER.METEROUTREADERLOCCODE IS 'Meter Outreader Location Code~~~D3033 - Indicates Meter Outreader Location as either inside or outside (of a building)';
COMMENT ON COLUMN DEL_METER.METERTREATMENT IS 'Meter Treatment~~~D3022 - Specifies whether the meter is a Wholesaler Water Meter or one of the various types of Private Meter';
COMMENT ON COLUMN DEL_METER.METERLOCATIONCODE IS 'Meter Location Code~~~D3025 - Indicates Meter Location as either inside or outside (of a building)';
COMMENT ON COLUMN DEL_METER.COMBIMETERFLAG IS 'Combi Meter Flag~~~D3034 - Indicates if meter is part of a combi meter. Each part of a combi meter must have this flag set.';
COMMENT ON COLUMN DEL_METER.YEARLYVOLESTIMATE IS 'Yearly Volume Estimate~~~D2010 - An estimate of the annual Volume supplied in relation to a meter or Discharge Point on the basis of the relevant Eligible Premises being Occupied Premises. Value in m3/a';
COMMENT ON COLUMN DEL_METER.REMOTEREADFLAG IS 'Remote Read Flag~~~D3037 - Indicates if a meter has the capability to be read remotely, including via an Outreader';
COMMENT ON COLUMN DEL_METER.REMOTEREADTYPE IS 'Remote Read Type~~~D3038 - Indicates the type of remote read capability for the meter';
COMMENT ON COLUMN DEL_METER.OUTREADERID IS 'Outreader ID~~~D3039 - Free text Data Item for the encoder reference, radio ID or logger number, or any other reference which will assist the Retailer in reading the meter';
COMMENT ON COLUMN DEL_METER.OUTREADERPROTOCOL IS 'Outreader Protocol~~~D3040 - Free text providing details of how the reading is accessed by the outreader. Will typically identify the manufacturers  protocol in use';
COMMENT ON COLUMN DEL_METER.OUTREADERLOCFREEDES IS 'Free Descriptor~~~D5001 - Free text descriptor for address/location  details';
COMMENT ON COLUMN DEL_METER.SECONDADDRESABLEOBJECT IS 'Secondary Addressable Object~~~D5002 - BS7666 Secondary Addressable Object if available';
COMMENT ON COLUMN DEL_METER.PRIMARYADDRESSABLEOBJECT IS 'Primary Addressable Object~~~D5003 - BS7666 Primary Addressable Object if available';
COMMENT ON COLUMN DEL_METER.ADDRESSLINE01 IS 'Address Line 1~~~D5004 - First line of address, or first line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_METER.ADDRESSLINE02 IS 'Address Line 2~~~D5005 - Second line of address, or second line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_METER.ADDRESSLINE03 IS 'Address Line 3~~~D5006 - Third line of address, or third line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_METER.ADDRESSLINE04 IS 'Address Line 4~~~D5007 - Fourth line of address, or fourth line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_METER.ADDRESSLINE05 IS 'Address Line 5~~~D5008 - Fifth line of address, or fifth line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_METER.POSTCODE IS 'Postcode~~~D5009 - Postcode (without spaces)';
COMMENT ON COLUMN DEL_METER.COUNTRY IS 'Country~~~D5010 - Country, if address is outside the UK';
COMMENT ON COLUMN DEL_METER.PAFADDRESSKEY IS 'PAF Address Key~~~D5011 - PAF Address Key if known';




CREATE TABLE DEL_METER_SUPPLY_POINT
(
MANUFACTURERSERIALNUM_PK VARCHAR(32) NOT NULL ,
MANUFACTURER_PK VARCHAR(32) NOT NULL ,
SPID_PK VARCHAR(13) NOT NULL
);

ALTER TABLE DEL_METER_SUPPLY_POINT ADD CONSTRAINT CH01_M2SPUNIQUEKEY UNIQUE (MANUFACTURERSERIALNUM_PK,MANUFACTURER_PK);
--ALTER TABLE DEL_METER_SUPPLY_POINT ADD CONSTRAINT FK01_SPIDFK FOREIGN KEY (SPID_PK) REFERENCES DEL_SUPPLY_POINT(SPID_PK);

COMMENT ON TABLE DEL_METER_SUPPLY_POINT IS 'Meter To Supply Point---Associations between meters and service components at supply point.';
COMMENT ON COLUMN DEL_METER_SUPPLY_POINT.MANUFACTURERSERIALNUM_PK IS 'Manufacturer Meter Serial Number~~~D3014 - Specifies the manufacturer’s serial number of a meter. STW011 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Serial field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER_SUPPLY_POINT.MANUFACTURER_PK IS 'Meter Manufacturer~~~D3013 - Specifies the make and/or manufacturer of a meter.  STW010 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Manufacturer field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER_SUPPLY_POINT.SPID_PK IS 'SPID~~~D2001 - Unique identifier allocated to each Supply Point by the Market Operator';


CREATE TABLE DEL_METER_NETWORK
(
SPID_PK VARCHAR(13) NOT NULL,
MAINMANUFACTURERSERIALNUM VARCHAR(32) NOT NULL,
MAINMANUFACTURER VARCHAR(32)  NOT NULL,
MAINMETERTREATMENT VARCHAR (32) NOT NULL,
SUBMANUFACTURERSERIALNUM VARCHAR(32), -- should be NOT NULL but we don't have any meter networks at present
SUBMANUFACTURER VARCHAR(32), -- should be NOT NULL but we don't have any meter networks at present
SUBMETERTREATMENT VARCHAR(32) -- should be NOT NULL but we don't have any meter networks at present
);

--ALTER TABLE DEL_METER_NETWORK ADD CONSTRAINT FK02_SPIDFK FOREIGN KEY (SPID_PK) REFERENCES DEL_SUPPLY_POINT(SPID_PK);

--ALTER TABLE DEL_METER_NETWORK ADD CONSTRAINT CH01_MAINSUBSERIAL CHECK (MAINMANUFACTURERSERIALNUM <> SUBMANUFACTURERSERIALNUM);
--ALTER TABLE DEL_METER_NETWORK ADD CONSTRAINT RF01_MAINMETERETREATMENT CHECK (MAINMETERTREATMENT IN ('POTABLE', 'NONPOTABLE'));
--ALTER TABLE DEL_METER_NETWORK ADD CONSTRAINT RF01_SUBMETERETREATMENT CHECK (SUBMETERTREATMENT IN ('POTABLE', 'NONPOTABLE','PRIVATEWATER'));

COMMENT ON TABLE DEL_METER_NETWORK IS 'Meter Network ---Allows CMOS to set up meter networks consisting of a main meter and one or mor sub meters.';
COMMENT ON COLUMN DEL_METER_NETWORK.SPID_PK IS 'SPID~~~D2001 - Unique identifier allocated to each Supply Point by the Market Operator';
COMMENT ON COLUMN DEL_METER_NETWORK.MAINMANUFACTURERSERIALNUM IS 'Manufacturer Meter Serial Number~~~D3014 - Specifies the manufacturer’s serial number of a meter. STW011 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Serial field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER_NETWORK.MAINMANUFACTURER IS 'Meter Manufacturer~~~D3013 - Specifies the make and/or manufacturer of a meter.  STW010 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Manufacturer field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER_NETWORK.SUBMANUFACTURERSERIALNUM IS 'Manufacturer Meter Serial Number~~~D3014 - Specifies the manufacturer’s serial number of a meter. STW011 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Serial field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER_NETWORK.SUBMANUFACTURER IS 'Meter Manufacturer~~~D3013 - Specifies the make and/or manufacturer of a meter.  STW010 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Manufacturer field.  Reason bng that there are instances where the serial number is not unique.';



CREATE TABLE DEL_METER_READING
(
MANUFACTURERSERIALNUM_PK VARCHAR(32) CONSTRAINT CH01_MANUFACTURERSERIALNUM NOT NULL,
MANUFACTURER_PK VARCHAR(32) CONSTRAINT CH01_MANUFACTURER NOT NULL,
METERREAD NUMBER(12) CONSTRAINT CH01_METERREAD NOT NULL,
METERREADMETHOD VARCHAR(9) CONSTRAINT CH01_METERREADMETHOD NOT NULL,
METERREADDATE DATE CONSTRAINT CH01_METERREADDATE NOT NULL,
ROLLOVERINDICATOR NUMBER(1) CONSTRAINT CH01_ROLLOVERINDICATOR NOT NULL,
ESTIMATEDREADREASONCODE VARCHAR(2) ,
ESTIMATEDREADREMEDIALWORKIND NUMBER(1) ,
METERREADTYPE VARCHAR(1) ,
PREVIOUSMETERREADING NUMBER(12) 
);
 
ALTER TABLE DEL_METER_READING ADD CONSTRAINT CH01_UNIQUEREADING UNIQUE (MANUFACTURER_PK,MANUFACTURERSERIALNUM_PK,METERREADDATE);
ALTER TABLE DEL_METER_READING ADD CONSTRAINT CH01_ESTIMATEDREADREASONCODE CHECK ((ESTIMATEDREADREASONCODE IS NOT NULL AND METERREADMETHOD = 'ESTIMATED') OR (ESTIMATEDREADREASONCODE IS NULL AND METERREADMETHOD <> 'ESTIMATED'));
ALTER TABLE DEL_METER_READING ADD CONSTRAINT CH01_ESTIMATEDREADREMEDIALWORK CHECK ((ESTIMATEDREADREMEDIALWORKIND IS NOT NULL AND METERREADMETHOD = 'ESTIMATED') OR (ESTIMATEDREADREMEDIALWORKIND IS NULL AND METERREADMETHOD <> 'ESTIMATED'));

ALTER TABLE DEL_METER_READING ADD CONSTRAINT RF01_METERREADTYPE CHECK (METERREADTYPE IN ('I', 'P'));
ALTER TABLE DEL_METER_READING ADD CONSTRAINT RF01_METERREADMETHOD CHECK (METERREADMETHOD IN ('VISUAL', 'CUSTOMER', 'REMOTE', 'ESTIMATED'));
ALTER TABLE DEL_METER_READING ADD CONSTRAINT RF01_ROLLOVERINDICATOR CHECK (ROLLOVERINDICATOR IN (0,1));
ALTER TABLE DEL_METER_READING ADD CONSTRAINT RF01_ESTIMATEDREADREASONCODE CHECK (ESTIMATEDREADREASONCODE IN ('DM', 'MI', 'NM', 'NA'));
ALTER TABLE DEL_METER_READING ADD CONSTRAINT RF01_ESTIMATEDREADREMEDIALWORK CHECK (ESTIMATEDREADREMEDIALWORKIND IN (0,1));

COMMENT ON TABLE DEL_METER_READING IS 'Meter Reading---Historic meter reads - up to 2 years of readings for each meter if available.';
COMMENT ON COLUMN DEL_METER_READING.MANUFACTURERSERIALNUM_PK IS 'Manufacturer Meter Serial Number~~~D3014 - Specifies the manufacturer’s serial number of a meter. STW011 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Serial field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER_READING.MANUFACTURER_PK IS 'Meter Manufacturer~~~D3013 - Specifies the make and/or manufacturer of a meter.  STW010 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Manufacturer field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER_READING.METERREAD IS 'Meter Read~~~D3008 - Register advance read from a meter in m3';
COMMENT ON COLUMN DEL_METER_READING.METERREADMETHOD IS 'Meter Read Method~~~D3044 - The method of meter reading';
COMMENT ON COLUMN DEL_METER_READING.METERREADDATE IS 'Meter Read Date~~~D3009 - Date of meter read';
COMMENT ON COLUMN DEL_METER_READING.ROLLOVERINDICATOR IS 'Rollover Indicator~~~D3020 - Proposes whether the meter read has rolled over or not as part of meter read submission by the Retailer or  Wholesaler';
COMMENT ON COLUMN DEL_METER_READING.ESTIMATEDREADREASONCODE IS 'Estimated Read Reason Code~~~D3028 - Identifies the reason for use of a Transfer Read with Meter Read Method of “Estimated”';
COMMENT ON COLUMN DEL_METER_READING.ESTIMATEDREADREMEDIALWORKIND IS 'Estimated Read Remedial Work Indicator~~~D3029 - Identifies whether remedial action has been obtained for a meter associated with a transfer, when a Transfer Read with Meter Read Method of “Estimated” is submitted';
COMMENT ON COLUMN DEL_METER_READING.METERREADTYPE IS 'Meter Read Type~~~D3010 - The type of meter reading';


CREATE TABLE DEL_DISCHARGE_POINT
(
SPID_PK VARCHAR(13) CONSTRAINT CH04_SPID NOT NULL,
DPID_PK VARCHAR(32) CONSTRAINT CH02_DPID NOT NULL,
TARRIFCODE VARCHAR(32) CONSTRAINT CH01_TARRIFCODE NOT NULL,
TARRIFBAND NUMBER(2) ,
TREFODCHEMOXYGENDEMAND NUMBER(6,0),
TREFODCHEMSUSPSOLDEMAND NUMBER(6,0),
TREFODCHEMAMONIANITROGENDEMAND NUMBER(6,0) ,
TREFODCHEMCOMPXDEMAND NUMBER(6,0) ,
TREFODCHEMCOMPYDEMAND NUMBER(6,0) ,
TREFODCHEMCOMPZDEMAND NUMBER(6,0) ,
SEWERAGEVOLUMEADJMENTHOD VARCHAR(8) CONSTRAINT CH01_SEWERAGEVOLUMEADJMENTHOD NOT NULL,
RECEPTIONTREATMENTINDICATOR NUMBER(1) CONSTRAINT CH01_RECEPTIONTREATMENTIND NOT NULL,
PRIMARYTREATMENTINDICATOR NUMBER(1) CONSTRAINT CH01_PRIMARYTREATMENTINDICATOR NOT NULL,
MARINETREATMENTINDICATOR NUMBER(1) CONSTRAINT CH01_MARINETREATMENTINDICATOR NOT NULL,
BIOLOGICALTREATMENTINDICATOR NUMBER(1) CONSTRAINT CH01_BIOLOGICALTREATMENTIND NOT NULL,
SLUDGETREATMENTINDICATOR NUMBER(1) CONSTRAINT CH01_SLUDGETREATMENTINDICATOR NOT NULL,
AMMONIATREATMENTINDICATOR NUMBER(1) CONSTRAINT CH01_AMMONIATREATMENTINDICATOR NOT NULL,
TEFXTREATMENTINDICATOR NUMBER(1) CONSTRAINT CH01_TEFXTREATMENTINDICATOR NOT NULL,
TEFYTREATMENTINDICATOR NUMBER(1) CONSTRAINT CH01_TEFYTREATMENTINDICATOR NOT NULL,
TEFZTREATMENTINDICATOR NUMBER(1) CONSTRAINT CH01_TEFZTREATMENTINDICATOR NOT NULL,
TEFAVAILABILITYDATAX NUMBER(9) ,
TEFAVAILABILITYDATAY NUMBER(9) ,
TEFAVAILABILITYDATAZ NUMBER(9) ,
CHARGEABLEDAILYVOL NUMBER(12) ,
CHEMICALOXYGENDEMAND NUMBER(12) ,
SUSPENDEDSOLIDSLOAD NUMBER(12) ,
AMMONIANITROCAL NUMBER(12) ,
FIXEDALLOWANCE NUMBER(12) CONSTRAINT CH01_FIXEDALLOWANCE NOT NULL,
PERCENTAGEALLOWANCE NUMBER(3) CONSTRAINT CH01_PERCENTAGEALLOWANCE NOT NULL,
DOMMESTICALLOWANCE NUMBER(12) ,
SEASONALFACTOR NUMBER(3) ,
DPIDSPECIALAGREEMENTINPLACE NUMBER(1) CONSTRAINT CH01_DPIDSPECIALAGREEMENT NOT NULL,
DPIDSPECIALAGREEMENTFACTOR NUMBER(3) ,
DPIDSPECIALAGREEMENTREFERENCE VARCHAR(12) ,
FREETEXTDESCRIPTOR VARCHAR(255) ,
SECONDADDRESSABLEOBJ VARCHAR(100) ,
PRIMARYADDRESSABLEOBJ VARCHAR(100) ,
ADDRESSLINE01 VARCHAR(60) CONSTRAINT CH04_ADDRESSLINE01 NOT NULL,
ADDRESSLINE02 VARCHAR(60) ,
ADDRESSLINE03 VARCHAR(60) ,
ADDRESSLINE04 VARCHAR(60) ,
ADDRESSLINE05 VARCHAR(60) ,
POSTCODE VARCHAR(8) CONSTRAINT CH04_POSTCODE NOT NULL,
PAFADDRESSKEY NUMBER(9),
VALIDTETARIFFCODE NUMBER NOT NULL,  -- used for constraints
TARIFFBANDCOUNT NUMBER NOT NULL, -- used for constraints
AMMONIACALNITROGEN NUMBER NOT NULL, -- used for constraints
XCOMP NUMBER NOT NULL, -- used for constraints
YCOMP NUMBER NOT NULL, -- used for constraints
ZCOMP NUMBER NOT NULL -- used for constraints
);

ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_UNIQUESPDPID UNIQUE (SPID_PK, DPID_PK);
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_VALIDTETARIFF CHECK (VALIDTETARIFFCODE > 0 AND TARRIFCODE IS NOT NULL);
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_TARIFFBANDCHK CHECK ((TARIFFBANDCOUNT > 0 AND TARRIFBAND IS NOT NULL) OR (TARIFFBANDCOUNT = 0 AND TARRIFBAND IS NULL));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_PERCENTAGEALLOWANCERANGE CHECK (PERCENTAGEALLOWANCE >= 0 AND PERCENTAGEALLOWANCE <=100);
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_SEASONALFACTORRANGE CHECK ((DPIDSPECIALAGREEMENTINPLACE = 1 AND SEASONALFACTOR >= 0 AND SEASONALFACTOR <=100)
                                                                                OR (DPIDSPECIALAGREEMENTINPLACE = 0 AND SEASONALFACTOR IS NULL));
--ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_POSTCODECHK CHECK ((LENGTH(TRIM(POSTCODE)) - INSTR(TRIM(POSTCODE),' ') = 3) AND (REGEXP_COUNT(TRIM(POSTCODE),' ') = 1));
                                                                                
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_SPECIALAGREEMENTREF CHECK ((DPIDSPECIALAGREEMENTINPLACE = 1 AND DPIDSPECIALAGREEMENTREFERENCE IS NOT NULL) OR (DPIDSPECIALAGREEMENTINPLACE = 0 AND DPIDSPECIALAGREEMENTREFERENCE IS NULL));

ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_AMMONIACALNITROGENCHK CHECK ((AMMONIACALNITROGEN > 0 AND AMMONIATREATMENTINDICATOR = 1 AND TREFODCHEMAMONIANITROGENDEMAND >= 0)
                                                                                  OR (AMMONIACALNITROGEN = 0 AND AMMONIATREATMENTINDICATOR <> 1 AND TREFODCHEMAMONIANITROGENDEMAND IS NULL));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_XCOMPCHK CHECK ((XCOMP > 0 AND TEFXTREATMENTINDICATOR = 1 AND TREFODCHEMCOMPXDEMAND >= 0)
                                                                                  OR (XCOMP = 0 AND TEFXTREATMENTINDICATOR <> 1 AND TREFODCHEMCOMPXDEMAND IS NULL));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_YCOMPCHK CHECK ((YCOMP > 0 AND TEFYTREATMENTINDICATOR = 1 AND TREFODCHEMCOMPYDEMAND >= 0)
                                                                                  OR (YCOMP = 0 AND TEFYTREATMENTINDICATOR <> 1 AND TREFODCHEMCOMPYDEMAND IS NULL));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_ZCOMPCHK CHECK ((ZCOMP > 0 AND TEFZTREATMENTINDICATOR = 1 AND TREFODCHEMCOMPZDEMAND >= 0)
                                                                                  OR (ZCOMP = 0 AND TEFZTREATMENTINDICATOR <> 1 AND TREFODCHEMCOMPZDEMAND IS NULL));

ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_XLOADCHK CHECK ((XCOMP > 0 AND TEFXTREATMENTINDICATOR = 1 AND TEFAVAILABILITYDATAX >= 0)
                                                                                  OR (XCOMP = 0 AND TEFXTREATMENTINDICATOR <> 1 AND TEFAVAILABILITYDATAX IS NULL));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_YLOADCHK CHECK ((YCOMP > 0 AND TEFYTREATMENTINDICATOR = 1 AND TEFAVAILABILITYDATAY >= 0)
                                                                                  OR (YCOMP = 0 AND TEFYTREATMENTINDICATOR <> 1 AND TEFAVAILABILITYDATAY IS NULL));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT CH01_ZLOADCHK CHECK ((ZCOMP > 0 AND TEFZTREATMENTINDICATOR = 1 AND TEFAVAILABILITYDATAY >= 0)
                                                                                  OR (ZCOMP = 0 AND TEFZTREATMENTINDICATOR <> 1 AND TEFAVAILABILITYDATAY IS NULL));

ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_RECEPTIONTREATMENTIND CHECK (RECEPTIONTREATMENTINDICATOR IN (0,1));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_PRIMARYTREATMENTINDICATOR CHECK (PRIMARYTREATMENTINDICATOR IN (0,1));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_MARINETREATMENTINDICATOR CHECK (MARINETREATMENTINDICATOR IN (0,1));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_BIOLOGICALTREATMENTIND CHECK (BIOLOGICALTREATMENTINDICATOR IN (0,1));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_SLUDGETREATMENTINDICATOR CHECK (SLUDGETREATMENTINDICATOR IN (0,1));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_AMMONIATREATMENTINDICATOR CHECK (AMMONIATREATMENTINDICATOR IN (0,1));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_TEFXTREATMENTINDICATOR CHECK (TEFXTREATMENTINDICATOR IN (0,1));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_TEFYTREATMENTINDICATOR CHECK (TEFYTREATMENTINDICATOR IN (0,1));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_TEFZTREATMENTINDICATOR CHECK (TEFZTREATMENTINDICATOR IN (0,1));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_SEWERAGEVOLUMEADJMENTHOD CHECK (SEWERAGEVOLUMEADJMENTHOD IN ('NONE', 'DA', 'SUBTRACT'));
ALTER TABLE DEL_DISCHARGE_POINT ADD CONSTRAINT RF01_DPIDSPECIALAGREEMENT CHECK (DPIDSPECIALAGREEMENTINPLACE IN (0,1));

COMMENT ON TABLE DEL_DISCHARGE_POINT IS 'Discharge Point---If a sewerage Supply Point has a Trade Effluent Service Component then it should have at least one and possibly many Discharge Points associated with the Trade Effluent Service Component. These can vary over time. A Discharge Point is a distinct point from which trade effluent sewerage is discharged from the Eligible Premise into the sewer network. ';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.SPID_PK IS 'SPID~~~D2001 - Unique identifier allocated to each Supply Point by the Market Operator. STW001 - FK implementing relationship to Trade Effluent Service Component of SPID';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.DPID_PK IS 'DPID~~~D6001 - The unique identifier per Wholesaler allocated to each Discharge Point by the Wholesaler.';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TARRIFCODE IS 'Tariff Code~~~D7001 - A short code specified by the Wholesaler for the Tariff. The Tariff Code should be meaningful. This code is unique to the Wholesaler for the Service Component and can never be changed. STW004 - FK implementing relationship to Tariff and (if used) the Tariff Band. Covers off D6020';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TARRIFBAND IS 'Tariff Band~~~D2081 - Tariff band number to be applied for Service Components where banded tariffs are permitted. Covers off D6024';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TREFODCHEMOXYGENDEMAND IS 'Ot~~~D6006 - Trade Effluent Operating Data: chemical oxygen demand (or other parameter as may be determined by the Wholesaler) in mg/l';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TREFODCHEMSUSPSOLDEMAND IS 'St~~~D6007 - Trade Effluent Operating Data: suspended solids (or other parameter as may be determined by the Wholesaler) in mg/l';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TREFODCHEMAMONIANITROGENDEMAND IS 'At~~~D6011 - Trade Effluent Operating Data: ammoniacal nitrogen content of the Trade Effluent in mg/l';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TREFODCHEMCOMPXDEMAND IS 'Xt~~~D6026 - Trade Effluent Operating Data: Trade Effluent Component X content in mg/l';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TREFODCHEMCOMPYDEMAND IS 'Yt~~~D6027 - Trade Effluent Operating Data: Trade Effluent Component Y content in mg/l';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TREFODCHEMCOMPZDEMAND IS 'Zt~~~D6028 - Trade Effluent Operating Data: Trade Effluent Component Z content in mg/l';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.SEWERAGEVOLUMEADJMENTHOD IS 'Sewerage Volume Adjustment Method~~~D6035 - The method by which Sewerage volumes are adjusted, if required, due to the DPID';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.RECEPTIONTREATMENTINDICATOR IS 'Reception Treatment Indicator~~~D6014 - Flag to indicate whether Reception Charges apply to Trade Effluent from the Discharge Point Variable name: RTI';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.PRIMARYTREATMENTINDICATOR IS 'Primary Treatment Indicator~~~D6015 - Flag to indicate Primary/Volumetric Charges apply to Trade Effluent from the Discharge Point Variable name: PTI';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.MARINETREATMENTINDICATOR IS 'Marine Treatment Indicator~~~D6016 - Flag to indicate whether Outfall (marine) Charges apply to Trade Effluent from the Discharge Point Variable name: MTI';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.BIOLOGICALTREATMENTINDICATOR IS 'Biological Treatment Indicator~~~D6017 - Flag to indicate whether Secondary (Biological) Charges apply to Trade Effluent from the Discharge Point Variable name: BTI';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.SLUDGETREATMENTINDICATOR IS 'Sludge Treatment Indicator~~~D6018 - Flag to indicate whether Sludge Treatment Charges apply to Trade Effluent from the Discharge Point Variable name: STI';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.AMMONIATREATMENTINDICATOR IS 'Ammonia Treatment Indicator~~~D6019 - Flag to indicate whether ammonia charges apply to Trade Effluent from the Discharge Point Variable name: ATI';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TEFXTREATMENTINDICATOR IS 'Trade Effluent Component X Treatment Indicator~~~D6029 - Flag to indicate whether Trade Effluent Component X applies at the Discharge Point. Variable name: XTI';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TEFYTREATMENTINDICATOR IS 'Trade Effluent Component Y Treatment Indicator~~~D6030 - Flag to indicate whether Trade Effluent Component Y applies at the Discharge Point. Variable name: YTI';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TEFZTREATMENTINDICATOR IS 'Trade Effluent Component Z Treatment Indicator~~~D6031 - Flag to indicate whether Trade Effluent Component Z applies at the Discharge Point Variable name: ZTI';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TEFAVAILABILITYDATAX IS 'cXl~~~D6032 - Trade Effluent Availability Data: Trade Effluent Component X Demand load in kg/day';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TEFAVAILABILITYDATAY IS 'cYl~~~D6033 - Trade Effluent Availability Data: Trade Effluent Component Y Demand load in kg/day';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.TEFAVAILABILITYDATAZ IS 'cZl~~~D6034 - Trade Effluent Availability Data: Trade Effluent Component Z Demand load in kg/day';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.CHARGEABLEDAILYVOL IS 'Chargeable Daily Volume~~~D6003 - Trade Effluent Availability Data: chargeable daily volume in m3/day';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.CHEMICALOXYGENDEMAND IS 'cCODl~~~D6004 - Trade Effluent Availability Data: chargeable chemical oxygen demand load (or other parameter as may be determined by the Wholesaler) in kg/day';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.SUSPENDEDSOLIDSLOAD IS 'cSSl~~~D6005 - Trade Effluent Availability Data: chargeable suspended solids load (or other parameter as may be determined by the Wholesaler) in kg/day';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.AMMONIANITROCAL IS 'cANl~~~D6002 - Trade Effluent Availability Data: chargeable ammoniacal nitrogen load in kg/day';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.FIXEDALLOWANCE IS 'Fixed Allowance~~~D6013 - The part of the Volume of Water Services of all meters associated with the Discharge Point which is expressed as an annual Volume in m3 and is not discharged to the Sewerage Wholesaler’s sewer; for example due to evaporation, because it is used in production or because it is Surface Water recorded by a Private Trade Effluent Meter in respect of which Surface Water Drainage Service charges are already applied. The Fixed Allowance is applied before the Percentage Allowance. The Fixed Allowance must be supplied';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.PERCENTAGEALLOWANCE IS 'Percentage Allowance~~~D6012 - The part of the Volume of Water Services of all meters associated with the Discharge Point which is expressed as a percentage and is not discharged to the Sewerage Wholesaler’s sewer, for example due to evaporation or because it is used in production. The Percentage Allowance is applied after the Fixed Allowance. The Percentage Allowance must be supplied';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.DOMMESTICALLOWANCE IS 'Domestic Allowance~~~D6009 - The annual Volume in m3 of Water Services in relation to water meters associated with a Discharge Point that is being used for domestic purposes and is discharged as Trade Effluent Services in relation to the Discharge Point. If the Sewerage Volume Adjustment Method is set to “DA”, then the Domestic Allowance must be specified. If the Sewerage Volume Adjustment Method is set to either “NONE” or “SUBTRACT”, then the Domestic Allowance must not be specified. For the avoidance of doubt, if a Domestic Allowance of zero (0) is specified, this will result in a zero volume being applied to the Foul Sewerage calculation in respect of the applicable meters';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.SEASONALFACTOR IS 'Seasonal Factor~~~D6010 - Trade Effluent Availability Data: premium to the Trade Effluent Charges in accordance with the Wholesale Tariff Document';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.DPIDSPECIALAGREEMENTINPLACE IS 'Special Agreement Flag~~~D2004 - Identifies the presence of a Special Agreement at a Service Component or a DPID';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.DPIDSPECIALAGREEMENTFACTOR IS 'Special Agreement Factor~~~D2003 - Percentage factor applied to a Service Component or a DPID where a Special Arrangement exists. When set to zero it results in a zero charge, when set to 100% no adjustment is applied, and can be set to > 100%';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.DPIDSPECIALAGREEMENTREFERENCE IS 'Special Agreement Reference~~~D2090 - Ofwat Reference for any S.142(2)(b) Special Agreement in place for the Service Component';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.FREETEXTDESCRIPTOR IS 'Free Descriptor~~~D5001 - Free text descriptor for address/location  details';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.SECONDADDRESSABLEOBJ IS 'Secondary Addressable Object~~~D5002 - BS7666 Secondary Addressable Object if available';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.PRIMARYADDRESSABLEOBJ IS 'Primary Addressable Object~~~D5003 - BS7666 Primary Addressable Object if available';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.ADDRESSLINE01 IS 'Address Line 1~~~D5004 - First line of address, or first line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.ADDRESSLINE02 IS 'Address Line 2~~~D5005 - Second line of address, or second line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.ADDRESSLINE03 IS 'Address Line 3~~~D5006 - Third line of address, or third line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.ADDRESSLINE04 IS 'Address Line 4~~~D5007 - Fourth line of address, or fourth line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.ADDRESSLINE05 IS 'Address Line 5~~~D5008 - Fifth line of address, or fifth line of address after Secondary Addressable Object and Primary Addressable Object if used';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.POSTCODE IS 'Postcode~~~D5009 - Postcode (without spaces)';
COMMENT ON COLUMN DEL_DISCHARGE_POINT.PAFADDRESSKEY IS 'PAF Address Key~~~D5011 - PAF Address Key if known';

CREATE TABLE DEL_METER_DISCHARGE_POINT
(
MANUFACTURERSERIALNUM_PK VARCHAR(32) CONSTRAINT CH02_MANUFACTURERSERIALNUM NOT NULL,
MANUFACTURER_PK VARCHAR(32) CONSTRAINT CH02_MANUFACTURER NOT NULL ,
DPID_PK VARCHAR(13) CONSTRAINT CH03_DPID NOT NULL ,
PERCENTAGEDISCHARGE NUMBER(5,2) CONSTRAINT CH01_PERCENTAGEDISCHARGE NOT NULL 
);

COMMENT ON TABLE DEL_METER_DISCHARGE_POINT IS 'Meter To Discharge Point---Associations between meters and discharge point.';
COMMENT ON COLUMN DEL_METER_DISCHARGE_POINT.MANUFACTURERSERIALNUM_PK IS 'Manufacturer Meter Serial Number~~~D3014 - Specifies the manufacturer’s serial number of a meter. STW011 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Serial field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER_DISCHARGE_POINT.MANUFACTURER_PK IS 'Meter Manufacturer~~~D3013 - Specifies the make and/or manufacturer of a meter.  STW010 - A concatination of both the Meter manufacturer value and Meter serial number are to be stored in Meter Manufacturer field.  Reason bng that there are instances where the serial number is not unique.';
COMMENT ON COLUMN DEL_METER_DISCHARGE_POINT.DPID_PK IS 'DPID~~~D6001 - The unique identifier per Wholesaler allocated to each Discharge Point by the Wholesaler.';
COMMENT ON COLUMN DEL_METER_DISCHARGE_POINT.PERCENTAGEDISCHARGE IS 'MDVol~~~D3024 - For a meter Discharge Point association, the percentage of the volume associated with a meter which is discharged to the Discharge Point';


CREATE TABLE DEL_CALCULATED_DISCHARGE
(
DPID_PK VARCHAR(13) CONSTRAINT CH01_DPID NOT NULL,
CALCDISCHARGEID_PK VARCHAR(12) CONSTRAINT CH01_CALCDISCHARGEID NOT NULL,
DISCHARGETYPE VARCHAR(12) CONSTRAINT CH01_DISCHARGETYPE NOT NULL,
SUBMISSIONFREQ VARCHAR(1) CONSTRAINT CH01_SUBMISSIONFREQ NOT NULL,
TEYEARLYVOLESTIMATE NUMBER(13) CONSTRAINT CH01_TEYEARLYVOLESTIMATE NOT NULL
);

ALTER TABLE DEL_CALCULATED_DISCHARGE ADD CONSTRAINT RF01_DISCHARGETYPE CHECK (DISCHARGETYPE IN ('CONTAMINATED', 'DELAYED', 'ESTIMATED', 'TANKERED', 'GENERIC'));
ALTER TABLE DEL_CALCULATED_DISCHARGE ADD CONSTRAINT RF01_SUBMISSIONFREQ CHECK (SUBMISSIONFREQ IN ('B', 'M'));


COMMENT ON TABLE DEL_CALCULATED_DISCHARGE IS 'Calculated Discharge---A Discharge of a particular type that is calculated for a Discharge Point for Settlement purposes.';
COMMENT ON COLUMN DEL_CALCULATED_DISCHARGE.DPID_PK IS 'DPID~~~D6001 - The unique identifier per Wholesaler allocated to each Discharge Point by the Wholesaler. STW - FK implementing relationship to Calculated Discharge';
COMMENT ON COLUMN DEL_CALCULATED_DISCHARGE.CALCDISCHARGEID_PK IS 'Calculated Discharge ID~~~D6023 - Unique reference for the discharge. STW - FK implementing relationship to Calculated Discharge';
COMMENT ON COLUMN DEL_CALCULATED_DISCHARGE.DISCHARGETYPE IS 'Discharge Type~~~D6022 -  Discharge type. ';
COMMENT ON COLUMN DEL_CALCULATED_DISCHARGE.SUBMISSIONFREQ IS 'Submission Frequency~~~D6025 - The frequency that the Retailer must submit Calculated Discharges';
COMMENT ON COLUMN DEL_CALCULATED_DISCHARGE.TEYEARLYVOLESTIMATE IS 'TE Yearly Volume Estimate~~~D2010 - An estimate of the annual Volume supplied in relation to a meter or Discharge Point on the basis of the relevant Eligible Premises being Occupied Premises. Value in m3/a';

commit;
exit;
